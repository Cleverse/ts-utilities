{"version":3,"sources":["../src/storage/onedrive.ts"],"sourcesContent":["import { BadRequestError } from \"../errors\"\n\nimport type { DriveItem } from \"@microsoft/microsoft-graph-types\"\n\nexport class OneDriveService {\n\t/**\n\t * Extract driveId and itemId from SharePoint URL\n\t *\n\t * @param {string} sharePointUrl - `https://{sharePointEndpoint}/drives/{driveId}/items/{itemId}`\n\t */\n\tstatic extractDriveItemFromURL(sharePointUrl: string): { driveId: string; itemId: string } {\n\t\tconst url = new URL(sharePointUrl)\n\t\tconst pathSegments = url.pathname.split(\"/\").filter((segment) => segment.length > 0)\n\n\t\tconst drivesIndex = pathSegments.indexOf(\"drives\")\n\t\tconst itemsIndex = pathSegments.indexOf(\"items\")\n\n\t\tif (drivesIndex === -1 || itemsIndex === -1 || drivesIndex >= itemsIndex) {\n\t\t\tthrow new BadRequestError(`OneDriveService: Invalid SharePoint URL format: ${sharePointUrl}`)\n\t\t}\n\n\t\tconst driveId = pathSegments[drivesIndex + 1]\n\t\tconst itemId = pathSegments[itemsIndex + 1]\n\n\t\tif (!driveId || !itemId) {\n\t\t\tthrow new BadRequestError(`OneDriveService: Could not extract driveId or itemId from URL: ${sharePointUrl}`)\n\t\t}\n\n\t\treturn {\n\t\t\tdriveId: OneDriveService.formatDriveId(driveId),\n\t\t\titemId: OneDriveService.formatItemId(itemId),\n\t\t}\n\t}\n\n\t// Convert itemId to standard format\n\tstatic formatItemId(itemId: string): string {\n\t\treturn itemId // TODO: no need to format itemId yet\n\t}\n\n\t// Convert driveId to standard format\n\tstatic formatDriveId(driveId: string): string {\n\t\t// b! prefix indicates Organization account (not Hex), leave as-is\n\t\tif (driveId.startsWith(\"b!\")) {\n\t\t\treturn driveId\n\t\t}\n\n\t\t// Otherwise it's likely Hex:\n\t\t// 1. Strip leading zeros\n\t\t// 2. Convert to UPPERCASE\n\t\treturn driveId.replace(/^0+/, \"\").toUpperCase()\n\t}\n\n\t// Format the drive item to the standard format\n\tstatic formatDriveItem(item: DriveItem): DriveItem {\n\t\tif (item.id) {\n\t\t\titem.id = OneDriveService.formatItemId(item.id)\n\t\t}\n\t\tif (item.parentReference?.driveId) {\n\t\t\titem.parentReference.driveId = OneDriveService.formatDriveId(item.parentReference.driveId)\n\t\t}\n\t\tif (item.parentReference?.id) {\n\t\t\titem.parentReference.id = OneDriveService.formatItemId(item.parentReference.id)\n\t\t}\n\t\treturn item\n\t}\n\n\tstatic encodeOneDriveItemUri(item: DriveItem, driveType: \"onedrive\" | \"sharepoint\" = \"onedrive\"): string {\n\t\tconst driveId = item.parentReference?.driveId\n\t\t\t? OneDriveService.formatDriveId(item.parentReference.driveId)\n\t\t\t: \"unknown\"\n\t\tconst itemId = item.id ? OneDriveService.formatItemId(item.id) : \"unknown\"\n\t\tconst siteId = item.parentReference?.siteId ?? \"unknown\"\n\n\t\treturn driveType === \"onedrive\" ? `onedrive://${driveId}/${itemId}` : `sharepoint://${siteId}/${driveId}/${itemId}`\n\t}\n}\n"],"mappings":";;;;;AAIO,IAAM,kBAAN,MAAM,iBAAgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAM5B,OAAO,wBAAwB,eAA4D;AAC1F,UAAM,MAAM,IAAI,IAAI,aAAa;AACjC,UAAM,eAAe,IAAI,SAAS,MAAM,GAAG,EAAE,OAAO,CAAC,YAAY,QAAQ,SAAS,CAAC;AAEnF,UAAM,cAAc,aAAa,QAAQ,QAAQ;AACjD,UAAM,aAAa,aAAa,QAAQ,OAAO;AAE/C,QAAI,gBAAgB,MAAM,eAAe,MAAM,eAAe,YAAY;AACzE,YAAM,IAAI,gBAAgB,mDAAmD,aAAa,EAAE;AAAA,IAC7F;AAEA,UAAM,UAAU,aAAa,cAAc,CAAC;AAC5C,UAAM,SAAS,aAAa,aAAa,CAAC;AAE1C,QAAI,CAAC,WAAW,CAAC,QAAQ;AACxB,YAAM,IAAI,gBAAgB,kEAAkE,aAAa,EAAE;AAAA,IAC5G;AAEA,WAAO;AAAA,MACN,SAAS,iBAAgB,cAAc,OAAO;AAAA,MAC9C,QAAQ,iBAAgB,aAAa,MAAM;AAAA,IAC5C;AAAA,EACD;AAAA;AAAA,EAGA,OAAO,aAAa,QAAwB;AAC3C,WAAO;AAAA,EACR;AAAA;AAAA,EAGA,OAAO,cAAc,SAAyB;AAE7C,QAAI,QAAQ,WAAW,IAAI,GAAG;AAC7B,aAAO;AAAA,IACR;AAKA,WAAO,QAAQ,QAAQ,OAAO,EAAE,EAAE,YAAY;AAAA,EAC/C;AAAA;AAAA,EAGA,OAAO,gBAAgB,MAA4B;AAClD,QAAI,KAAK,IAAI;AACZ,WAAK,KAAK,iBAAgB,aAAa,KAAK,EAAE;AAAA,IAC/C;AACA,QAAI,KAAK,iBAAiB,SAAS;AAClC,WAAK,gBAAgB,UAAU,iBAAgB,cAAc,KAAK,gBAAgB,OAAO;AAAA,IAC1F;AACA,QAAI,KAAK,iBAAiB,IAAI;AAC7B,WAAK,gBAAgB,KAAK,iBAAgB,aAAa,KAAK,gBAAgB,EAAE;AAAA,IAC/E;AACA,WAAO;AAAA,EACR;AAAA,EAEA,OAAO,sBAAsB,MAAiB,YAAuC,YAAoB;AACxG,UAAM,UAAU,KAAK,iBAAiB,UACnC,iBAAgB,cAAc,KAAK,gBAAgB,OAAO,IAC1D;AACH,UAAM,SAAS,KAAK,KAAK,iBAAgB,aAAa,KAAK,EAAE,IAAI;AACjE,UAAM,SAAS,KAAK,iBAAiB,UAAU;AAE/C,WAAO,cAAc,aAAa,cAAc,OAAO,IAAI,MAAM,KAAK,gBAAgB,MAAM,IAAI,OAAO,IAAI,MAAM;AAAA,EAClH;AACD;","names":[]}