{"version":3,"sources":["../src/logger/gcp-options.ts"],"sourcesContent":["import type { Level, LoggerOptions } from \"pino\"\n\n// Map Pino levels to Google Cloud Logging severity levels\n// https://cloud.google.com/logging/docs/reference/v2/rest/v2/LogEntry#LogSeverity\nconst levelToSeverity: Record<Level, string> = {\n\ttrace: \"DEBUG\",\n\tdebug: \"DEBUG\",\n\tinfo: \"INFO\",\n\twarn: \"WARNING\",\n\terror: \"ERROR\",\n\tfatal: \"CRITICAL\",\n}\n\n// https://cloud.google.com/logging/docs/structured-logging#special-payload-fields\nexport const gcpPinoLoggerOptions: LoggerOptions = {\n\tmessageKey: \"message\",\n\tformatters: {\n\t\tlevel(label: string) {\n\t\t\tconst pinoLevel = label as Level\n\t\t\tconst severity = levelToSeverity[pinoLevel]\n\t\t\t// `@type` property tells Error Reporting to track even if there is no `stack_trace`\n\t\t\t// https://cloud.google.com/error-reporting/docs/formatting-error-messages#log-text\n\t\t\tconst typeProp =\n\t\t\t\tpinoLevel === \"error\" || pinoLevel === \"fatal\"\n\t\t\t\t\t? {\n\t\t\t\t\t\t\t\"@type\": \"type.googleapis.com/google.devtools.clouderrorreporting.v1beta1.ReportedErrorEvent\",\n\t\t\t\t\t\t}\n\t\t\t\t\t: {}\n\t\t\treturn { severity, ...typeProp }\n\t\t},\n\n\t\tlog(object) {\n\t\t\t// add stack_trace field to object, if exists. ref: https://cloud.google.com/error-reporting/docs/formatting-error-messages#format-log-entry\n\t\t\tconst logObject = object as { err?: Error }\n\t\t\tconst stackTrace = logObject.err?.stack\n\t\t\tconst stackProp = stackTrace ? { stack_trace: stackTrace } : {}\n\t\t\treturn { ...object, ...stackProp }\n\t\t},\n\t},\n}\n"],"mappings":";AAIA,IAAM,kBAAyC;AAAA,EAC9C,OAAO;AAAA,EACP,OAAO;AAAA,EACP,MAAM;AAAA,EACN,MAAM;AAAA,EACN,OAAO;AAAA,EACP,OAAO;AACR;AAGO,IAAM,uBAAsC;AAAA,EAClD,YAAY;AAAA,EACZ,YAAY;AAAA,IACX,MAAM,OAAe;AACpB,YAAM,YAAY;AAClB,YAAM,WAAW,gBAAgB,SAAS;AAG1C,YAAM,WACL,cAAc,WAAW,cAAc,UACpC;AAAA,QACA,SAAS;AAAA,MACV,IACC,CAAC;AACL,aAAO,EAAE,UAAU,GAAG,SAAS;AAAA,IAChC;AAAA,IAEA,IAAI,QAAQ;AAEX,YAAM,YAAY;AAClB,YAAM,aAAa,UAAU,KAAK;AAClC,YAAM,YAAY,aAAa,EAAE,aAAa,WAAW,IAAI,CAAC;AAC9D,aAAO,EAAE,GAAG,QAAQ,GAAG,UAAU;AAAA,IAClC;AAAA,EACD;AACD;","names":[]}