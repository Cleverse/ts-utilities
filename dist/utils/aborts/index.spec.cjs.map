{"version":3,"sources":["/home/runner/work/ts-utilities/ts-utilities/dist/utils/aborts/index.spec.cjs","../../../src/utils/aborts/index.spec.ts"],"names":[],"mappings":"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","file":"/home/runner/work/ts-utilities/ts-utilities/dist/utils/aborts/index.spec.cjs","sourcesContent":[null,"import { describe, expect, it, vi, beforeEach, afterEach } from \"vitest\"\n\nimport { Aborts } from \"./index\"\n\ndescribe(\"aborts\", () => {\n\tbeforeEach(() => {\n\t\tvi.useFakeTimers()\n\t})\n\n\tafterEach(() => {\n\t\tvi.useRealTimers()\n\t})\n\n\tdescribe(\"awaitAbort\", () => {\n\t\tit(\"should resolve when signal is aborted\", async () => {\n\t\t\tconst controller = new AbortController()\n\n\t\t\t// Trigger abort in future\n\t\t\tsetTimeout(() => controller.abort(), 100)\n\n\t\t\tconst promise = Aborts.awaitAbort(controller.signal)\n\n\t\t\t// Should not resolve yet\n\t\t\tconst resolved = vi.fn()\n\t\t\tpromise.then(resolved)\n\t\t\texpect(resolved).not.toHaveBeenCalled()\n\n\t\t\t// Advance time\n\t\t\tawait vi.advanceTimersByTimeAsync(100)\n\n\t\t\texpect(resolved).toHaveBeenCalled()\n\t\t})\n\n\t\tit(\"should resolve immediately if already aborted\", async () => {\n\t\t\tconst controller = new AbortController()\n\t\t\tcontroller.abort()\n\n\t\t\tconst promise = Aborts.awaitAbort(controller.signal)\n\t\t\tawait expect(promise).resolves.toBeUndefined()\n\t\t})\n\t})\n\n\tdescribe(\"awaitAbortWithReject\", () => {\n\t\tit(\"should reject when signal is aborted\", async () => {\n\t\t\tconst controller = new AbortController()\n\t\t\tsetTimeout(() => controller.abort(new Error(\"aborted\")), 100)\n\n\t\t\tconst promise = Aborts.awaitAbortWithReject(controller.signal)\n\n\t\t\t// Catch the rejection to prevent \"Unhandled Rejection\"\n\t\t\tconst catchFn = vi.fn()\n\t\t\tpromise.catch(catchFn)\n\n\t\t\t// Advance time\n\t\t\tawait vi.advanceTimersByTimeAsync(100)\n\n\t\t\tawait expect(promise).rejects.toThrow(\"aborted\")\n\t\t})\n\n\t\tit(\"should reject immediately if already aborted\", async () => {\n\t\t\tconst controller = new AbortController()\n\t\t\tcontroller.abort(new Error(\"aborted\"))\n\n\t\t\tawait expect(Aborts.awaitAbortWithReject(controller.signal)).rejects.toThrow(\"aborted\")\n\t\t})\n\t})\n\n\tdescribe(\"awaitAbortOrTimeout\", () => {\n\t\tit(\"should return timeout if time passes first\", async () => {\n\t\t\tconst controller = new AbortController()\n\t\t\tconst promise = Aborts.awaitAbortOrTimeout(controller.signal, 100)\n\n\t\t\tawait vi.advanceTimersByTimeAsync(100)\n\n\t\t\tawait expect(promise).resolves.toBe(\"timeout\")\n\t\t})\n\n\t\tit(\"should return aborted if signal aborts first\", async () => {\n\t\t\tconst controller = new AbortController()\n\t\t\tsetTimeout(() => controller.abort(), 50)\n\n\t\t\tconst promise = Aborts.awaitAbortOrTimeout(controller.signal, 100)\n\n\t\t\tawait vi.advanceTimersByTimeAsync(50)\n\n\t\t\tawait expect(promise).resolves.toBe(\"aborted\")\n\t\t})\n\t})\n\n\tdescribe(\"raceWithAbort\", () => {\n\t\tit(\"should return fulfilled status with value\", async () => {\n\t\t\tconst controller = new AbortController()\n\t\t\tconst result = await Aborts.raceWithAbort(controller.signal, async () => \"success\")\n\n\t\t\texpect(result).toEqual({ status: \"fulfilled\", value: \"success\" })\n\t\t})\n\n\t\tit(\"should return aborted status with reason\", async () => {\n\t\t\tconst controller = new AbortController()\n\n\t\t\t// Abort after 10ms\n\t\t\tsetTimeout(() => controller.abort(), 10)\n\n\t\t\tconst promise = Aborts.raceWithAbort(controller.signal, async () => {\n\t\t\t\t// Task that takes longer than abort\n\t\t\t\tawait new Promise((resolve) => setTimeout(resolve, 50))\n\t\t\t\treturn \"should not reach here\"\n\t\t\t})\n\n\t\t\t// Advance past abort time but before task completion\n\t\t\tawait vi.advanceTimersByTimeAsync(10)\n\n\t\t\tconst result = await promise\n\t\t\texpect(result.status).toBe(\"aborted\")\n\t\t\texpect(result.reason).toBeInstanceOf(DOMException)\n\t\t\texpect((result.reason as DOMException).name).toBe(\"AbortError\")\n\t\t})\n\n\t\tit(\"should throw non-abort errors\", async () => {\n\t\t\tconst controller = new AbortController()\n\n\t\t\tawait expect(\n\t\t\t\tAborts.raceWithAbort(controller.signal, async () => {\n\t\t\t\t\tthrow new Error(\"fail\")\n\t\t\t\t}),\n\t\t\t).rejects.toThrow(\"fail\")\n\t\t})\n\t})\n\n\tdescribe(\"withAbortSignal\", () => {\n\t\tit(\"should reject with abort reason if aborted during execution\", async () => {\n\t\t\tconst controller = new AbortController()\n\n\t\t\tsetTimeout(() => controller.abort(new Error(\"cancelled\")), 10)\n\n\t\t\tconst promise = Aborts.withAbortSignal(controller.signal, async () => {\n\t\t\t\tawait new Promise((resolve) => setTimeout(resolve, 50))\n\t\t\t})\n\n\t\t\t// Catch the rejection to prevent \"Unhandled Rejection\"\n\t\t\tconst catchFn = vi.fn()\n\t\t\tpromise.catch(catchFn)\n\n\t\t\tawait vi.advanceTimersByTimeAsync(10)\n\n\t\t\tawait expect(promise).rejects.toThrow(\"cancelled\")\n\t\t})\n\t})\n\n\tdescribe(\"raceAllWithAbort\", () => {\n\t\tit(\"should resolve with first completed promise\", async () => {\n\t\t\tconst controller = new AbortController()\n\n\t\t\tconst promise = Aborts.raceAllWithAbort(controller.signal, [\n\t\t\t\tasync () => {\n\t\t\t\t\tawait new Promise((r) => setTimeout(r, 50))\n\t\t\t\t\treturn 1\n\t\t\t\t},\n\t\t\t\tasync () => {\n\t\t\t\t\tawait new Promise((r) => setTimeout(r, 10))\n\t\t\t\t\treturn 2\n\t\t\t\t},\n\t\t\t])\n\n\t\t\tawait vi.advanceTimersByTimeAsync(10)\n\n\t\t\tawait expect(promise).resolves.toBe(2)\n\t\t})\n\t})\n})\n"]}