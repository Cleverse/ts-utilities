{"version":3,"sources":["../../../src/utils/errors/index.spec.ts"],"sourcesContent":["import { VError } from \"verror\"\nimport { describe, expect, it } from \"vitest\"\n\nimport { errors } from \"./index\"\n\ndescribe(\"errors\", () => {\n\tclass CustomError extends Error {\n\t\tconstructor(message: string) {\n\t\t\tsuper(message)\n\t\t\tthis.name = \"CustomError\"\n\t\t}\n\t}\n\n\tdescribe(\"find\", () => {\n\t\tit(\"should find error in simple cause chain\", () => {\n\t\t\tconst root = new CustomError(\"root\")\n\t\t\tconst err = new Error(\"wrapper\", { cause: root })\n\n\t\t\tconst found = errors.find(err, CustomError)\n\t\t\texpect(found).toBe(root)\n\t\t\texpect(found).toBeInstanceOf(CustomError)\n\t\t})\n\n\t\tit(\"should find error in VError chain\", () => {\n\t\t\tconst root = new CustomError(\"root\")\n\t\t\tconst err = new VError(root, \"wrapper\")\n\n\t\t\tconst found = errors.find(err, CustomError)\n\t\t\texpect(found).toBe(root)\n\t\t})\n\n\t\tit(\"should return undefined if not found\", () => {\n\t\t\tconst err = new Error(\"simple\")\n\t\t\tconst found = errors.find(err, CustomError)\n\t\t\texpect(found).toBeUndefined()\n\t\t})\n\t})\n\n\tdescribe(\"is\", () => {\n\t\tit(\"should return true if error matches type in chain\", () => {\n\t\t\tconst root = new CustomError(\"root\")\n\t\t\tconst err = new Error(\"wrapper\", { cause: root })\n\n\t\t\texpect(errors.is(err, CustomError)).toBe(true)\n\t\t})\n\n\t\tit(\"should return false if error not found in chain\", () => {\n\t\t\tconst err = new Error(\"simple\")\n\t\t\texpect(errors.is(err, CustomError)).toBe(false)\n\t\t})\n\t})\n\n\tdescribe(\"as\", () => {\n\t\tit(\"should return true and narrow type if direct instance\", () => {\n\t\t\tconst err = new CustomError(\"test\")\n\t\t\tif (errors.as(err, CustomError)) {\n\t\t\t\texpect(err.message).toBe(\"test\")\n\t\t\t} else {\n\t\t\t\tthrow new Error(\"should be CustomError\")\n\t\t\t}\n\t\t})\n\n\t\tit(\"should return false if not direct instance\", () => {\n\t\t\tconst root = new CustomError(\"root\")\n\t\t\tconst err = new Error(\"wrapper\", { cause: root })\n\n\t\t\t// errors.as checks strictly `instanceof`, unlike errors.is/find which traverse causes\n\t\t\texpect(errors.as(err, CustomError)).toBe(false)\n\t\t})\n\t})\n\n\tdescribe(\"unwrap\", () => {\n\t\tit(\"should unwrap simple cause\", () => {\n\t\t\tconst root = new Error(\"root\")\n\t\t\tconst err = new Error(\"wrapper\", { cause: root })\n\n\t\t\texpect(errors.unwrap(err)).toBe(root)\n\t\t})\n\n\t\tit(\"should unwrap VError cause\", () => {\n\t\t\tconst root = new Error(\"root\")\n\t\t\tconst err = new VError(root, \"wrapper\")\n\n\t\t\texpect(errors.unwrap(err)).toBe(root)\n\t\t})\n\n\t\tit(\"should return undefined if no cause\", () => {\n\t\t\tconst err = new Error(\"simple\")\n\t\t\texpect(errors.unwrap(err)).toBeUndefined()\n\t\t})\n\t})\n\n\tdescribe(\"join\", () => {\n\t\tit(\"should join multiple errors into MultiError\", () => {\n\t\t\tconst err1 = new Error(\"one\")\n\t\t\tconst err2 = new Error(\"two\")\n\n\t\t\tconst joined = errors.join([err1, err2])\n\n\t\t\texpect(joined).toBeInstanceOf(VError.MultiError)\n\t\t\t// VError.MultiError usually exposes errors via a method or property, check if implementation wraps correctly\n\t\t\t// The implementation uses VError.errorFromList(errs)\n\t\t})\n\t})\n})\n"],"mappings":"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","names":[]}