{"version":3,"sources":["../../../src/utils/miscellaneous/checksum.ts"],"sourcesContent":["import base64url from \"base64url\"\n\nexport type ChecksumAlgorithm = \"md5\" | \"crc32c\" | \"sha1\" | \"sha256\" | \"sha512\" | \"quickXorHash\"\n\nexport class ChecksumUtils {\n\t/**\n\t * Serialize the checksum into a string in the format of `{algorithm}:{hash}`\n\t * @param {ChecksumAlgorithm} algorithm - The algorithm to use\n\t * @param {string} hash - The hash to stringify\n\t * @returns The checksum string in the format of `{algorithm}:{hash}`\n\t */\n\tstatic serialize(algorithm: ChecksumAlgorithm, hash: string): string {\n\t\treturn `${algorithm}:${hash}`\n\t}\n\n\t/**\n\t * Deserialize the checksum string into algorithm and hash\n\t * @param {string} checksum - The checksum string in the format of `{algorithm}:{hash}` or `{hash}` for md5\n\t * @returns The algorithm and hash\n\t */\n\tstatic deserialize(checksum: string): { algorithm: ChecksumAlgorithm; hash: string } {\n\t\tconst parts = checksum.split(\":\")\n\t\tif (parts.length === 1) {\n\t\t\treturn { algorithm: \"md5\", hash: parts[0] ?? \"\" }\n\t\t}\n\t\treturn { algorithm: parts[0] as ChecksumAlgorithm, hash: parts[1] ?? \"\" }\n\t}\n\n\t/**\n\t * Check if the checksums can be compared (same algorithm)\n\t * @param {string} a - The first checksum\n\t * @param {string} b - The second checksum\n\t * @returns {boolean} True if the checksums can be compared\n\t */\n\tstatic canCompare(a: string, b: string): boolean {\n\t\tconst aParts = this.deserialize(a)\n\t\tconst bParts = this.deserialize(b)\n\t\treturn aParts.algorithm === bParts.algorithm\n\t}\n\n\t/**\n\t * Compare two checksums\n\t * @param {string} a - The first checksum\n\t * @param {string} b - The second checksum\n\t * @returns {boolean} True if the checksums are the same\n\t */\n\tstatic compare(a: string, b: string): boolean {\n\t\tconst aParts = this.deserialize(a)\n\t\tconst bParts = this.deserialize(b)\n\t\treturn aParts.algorithm === bParts.algorithm && aParts.hash === bParts.hash\n\t}\n}\n\n/**\n * SafeChecksum is a class that provides methods to encode and decode checksums to base64url.\n * Currently, we only support for base64 input.\n */\nexport class SafeChecksum {\n\tstatic encode(str: string): string {\n\t\treturn base64url.fromBase64(str)\n\t}\n\tstatic decode(str: string): string {\n\t\treturn base64url.toBase64(str)\n\t}\n}\n"],"mappings":";;;AAAA,OAAO,eAAe;AAIf,IAAM,gBAAN,MAAoB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAO1B,OAAO,UAAU,WAA8B,MAAsB;AACpE,WAAO,GAAG,SAAS,IAAI,IAAI;AAAA,EAC5B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,OAAO,YAAY,UAAkE;AACpF,UAAM,QAAQ,SAAS,MAAM,GAAG;AAChC,QAAI,MAAM,WAAW,GAAG;AACvB,aAAO,EAAE,WAAW,OAAO,MAAM,MAAM,CAAC,KAAK,GAAG;AAAA,IACjD;AACA,WAAO,EAAE,WAAW,MAAM,CAAC,GAAwB,MAAM,MAAM,CAAC,KAAK,GAAG;AAAA,EACzE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,OAAO,WAAW,GAAW,GAAoB;AAChD,UAAM,SAAS,KAAK,YAAY,CAAC;AACjC,UAAM,SAAS,KAAK,YAAY,CAAC;AACjC,WAAO,OAAO,cAAc,OAAO;AAAA,EACpC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,OAAO,QAAQ,GAAW,GAAoB;AAC7C,UAAM,SAAS,KAAK,YAAY,CAAC;AACjC,UAAM,SAAS,KAAK,YAAY,CAAC;AACjC,WAAO,OAAO,cAAc,OAAO,aAAa,OAAO,SAAS,OAAO;AAAA,EACxE;AACD;AAMO,IAAM,eAAN,MAAmB;AAAA,EACzB,OAAO,OAAO,KAAqB;AAClC,WAAO,UAAU,WAAW,GAAG;AAAA,EAChC;AAAA,EACA,OAAO,OAAO,KAAqB;AAClC,WAAO,UAAU,SAAS,GAAG;AAAA,EAC9B;AACD;","names":[]}