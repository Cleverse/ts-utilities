{"version":3,"sources":["/home/runner/work/ts-utilities/ts-utilities/dist/utils/miscellaneous/jsonl.spec.cjs","../../../src/utils/miscellaneous/jsonl.spec.ts"],"names":[],"mappings":"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","file":"/home/runner/work/ts-utilities/ts-utilities/dist/utils/miscellaneous/jsonl.spec.cjs","sourcesContent":[null,"import { describe, expect, it } from \"vitest\"\n\nimport { jsonlDecodeStream, jsonlDecodeStreamAsync } from \"./jsonl\"\n\ndescribe(\"miscellaneous/jsonl\", () => {\n\tconst createStream = (chunks: string[]) => {\n\t\treturn new ReadableStream({\n\t\t\tstart(controller) {\n\t\t\t\tfor (const chunk of chunks) {\n\t\t\t\t\tcontroller.enqueue(new TextEncoder().encode(chunk))\n\t\t\t\t}\n\t\t\t\tcontroller.close()\n\t\t\t},\n\t\t})\n\t}\n\n\tdescribe(\"jsonlDecodeStreamAsync\", () => {\n\t\tit(\"should decode valid JSONL stream\", async () => {\n\t\t\tconst chunks = ['{\"id\":1}\\n{\"id\":2}\\n', '{\"id\":3}']\n\t\t\tconst stream = createStream(chunks)\n\t\t\tconst result: unknown[] = []\n\n\t\t\tfor await (const item of jsonlDecodeStreamAsync(stream)) {\n\t\t\t\tresult.push(item)\n\t\t\t}\n\n\t\t\texpect(result).toEqual([{ id: 1 }, { id: 2 }, { id: 3 }])\n\t\t})\n\n\t\tit(\"should handle split lines across chunks\", async () => {\n\t\t\tconst chunks = ['{\"id\":1}\\n{\"id\"', ':2}\\n{\"id\":3}']\n\t\t\tconst stream = createStream(chunks)\n\t\t\tconst result: unknown[] = []\n\n\t\t\tfor await (const item of jsonlDecodeStreamAsync(stream)) {\n\t\t\t\tresult.push(item)\n\t\t\t}\n\n\t\t\texpect(result).toEqual([{ id: 1 }, { id: 2 }, { id: 3 }])\n\t\t})\n\n\t\tit(\"should throw error on invalid JSON\", async () => {\n\t\t\tconst stream = createStream(['{\"id\":1}\\ninvalid-json\\n'])\n\n\t\t\tawait expect(async () => {\n\t\t\t\tfor await (const _ of jsonlDecodeStreamAsync(stream)) {\n\t\t\t\t\t// consume\n\t\t\t\t}\n\t\t\t}).rejects.toThrow(\"Failed to parse JSONL line\")\n\t\t})\n\n\t\tit(\"should skip invalid lines if requested\", async () => {\n\t\t\tconst stream = createStream(['{\"id\":1}\\ninvalid-json\\n{\"id\":2}'])\n\t\t\tconst result: unknown[] = []\n\n\t\t\tfor await (const item of jsonlDecodeStreamAsync(stream, { skipInvalidLine: true })) {\n\t\t\t\tresult.push(item)\n\t\t\t}\n\n\t\t\texpect(result).toEqual([{ id: 1 }, { id: 2 }])\n\t\t})\n\t})\n\n\tdescribe(\"jsonlDecodeStream\", () => {\n\t\tit(\"should decode stream to array\", async () => {\n\t\t\tconst stream = createStream(['{\"a\":1}\\n{\"b\":2}'])\n\t\t\tconst result = await jsonlDecodeStream(stream)\n\t\t\texpect(result).toEqual([{ a: 1 }, { b: 2 }])\n\t\t})\n\t})\n})\n"]}