{"version":3,"sources":["/home/runner/work/ts-utilities/ts-utilities/dist/chunk-DCHAHK5W.cjs","../src/encryption/index.ts"],"names":[],"mappings":"AAAA;AACE;AACF,wDAA6B;AAC7B;AACA;ACJA,8CAAA,CAAA;AAAA,gFAAmB;AAEnB,gFAAmB;AAKZ,IAAM,iBAAA,EAAN,MAAuB;AAAA;AAAA;AAAA;AAAA,EAI7B,OAAA,MAAa,aAAA,CACZ,IAAA,EACA,aAAA,EACA,KAAA,EAME;AACF,IAAA,IAAI;AAEH,MAAA,MAAM,YAAA,mBAAc,KAAA,UAAS,gBAAA,CAAO,WAAA,CAAY,EAAE,GAAA;AAGlD,MAAA,MAAM,UAAA,EAAY,MAAA,CAAO,IAAA,CAAK,aAAA,EAAe,MAAM,CAAA;AACnD,MAAA,GAAA,CAAI,SAAA,CAAU,OAAA,IAAW,EAAA,EAAI;AAC5B,QAAA,MAAM,IAAI,qBAAA,CAAO,qDAAqD,CAAA;AAAA,MACvE;AAGA,MAAA,MAAM,OAAA,EAAS,gBAAA,CAAO,cAAA,CAAe,aAAA,EAAe,SAAA,EAAW,WAAW,CAAA;AAG1E,MAAA,MAAM,UAAA,EAAY,MAAA,CAAO,MAAA,CAAO,CAAC,MAAA,CAAO,MAAA,CAAO,IAAI,CAAA,EAAG,MAAA,CAAO,KAAA,CAAM,CAAC,CAAC,CAAA;AACrE,MAAA,MAAM,QAAA,EAAU,MAAA,CAAO,UAAA,CAAW,CAAA;AAGlC,MAAA,MAAM,WAAA,EAAa,MAAA,CAAO,MAAA,CAAO,CAAC,SAAA,EAAW,OAAO,CAAC,CAAA;AAGrD,MAAA,MAAM,iBAAA,EAAmB,UAAA,CAAW,QAAA,CAAS,QAAQ,CAAA;AAErD,MAAA,OAAO;AAAA,QACN,UAAA,EAAY,gBAAA;AAAA,QACZ,KAAA,EAAO,IAAI,UAAA,CAAW,WAAW;AAAA,MAClC,CAAA;AAAA,IACD,EAAA,MAAA,CAAS,KAAA,EAAO;AACf,MAAA,MAAM,IAAI,qBAAA,CAAO,KAAA,EAAgB,CAAA,sBAAA,CAAwB,CAAA;AAAA,IAC1D;AAAA,EACD;AAAA;AAAA;AAAA;AAAA,EAKA,OAAA,MAAa,aAAA,CAAc,IAAA,EAAc,KAAA,EAAmB,aAAA,EAA4C;AACvG,IAAA,IAAI;AAEH,MAAA,MAAM,UAAA,EAAY,MAAA,CAAO,IAAA,CAAK,aAAA,EAAe,MAAM,CAAA;AACnD,MAAA,GAAA,CAAI,SAAA,CAAU,OAAA,IAAW,EAAA,EAAI;AAC5B,QAAA,MAAM,IAAI,qBAAA,CAAO,qDAAqD,CAAA;AAAA,MACvE;AAGA,MAAA,MAAM,YAAA,EAAc,MAAA,CAAO,IAAA,CAAK,IAAA,EAAM,QAAQ,CAAA;AAG9C,MAAA,MAAM,QAAA,EAAU,WAAA,CAAY,QAAA,CAAS,CAAA,EAAG,CAAA;AACxC,MAAA,MAAM,UAAA,EAAY,WAAA,CAAY,QAAA,CAAS,CAAA,EAAG,CAAA,EAAG,CAAA;AAG7C,MAAA,MAAM,SAAA,EAAW,gBAAA,CAAO,gBAAA,CAAiB,aAAA,EAAe,SAAA,EAAW,MAAA,CAAO,IAAA,CAAK,KAAK,CAAC,CAAA;AACrF,MAAA,QAAA,CAAS,UAAA,CAAW,OAAO,CAAA;AAG3B,MAAA,MAAM,UAAA,EAAY,MAAA,CAAO,MAAA,CAAO,CAAC,QAAA,CAAS,MAAA,CAAO,SAAS,CAAA,EAAG,QAAA,CAAS,KAAA,CAAM,CAAC,CAAC,CAAA;AAE9E,MAAA,OAAO,IAAI,UAAA,CAAW,SAAS,CAAA;AAAA,IAChC,EAAA,MAAA,CAAS,KAAA,EAAO;AACf,MAAA,MAAM,IAAI,qBAAA,CAAO,KAAA,EAAgB,CAAA,sBAAA,CAAwB,CAAA;AAAA,IAC1D;AAAA,EACD;AACD,CAAA;AD9BA;AACA;AACE;AACF,4CAAC","file":"/home/runner/work/ts-utilities/ts-utilities/dist/chunk-DCHAHK5W.cjs","sourcesContent":[null,"import crypto from \"node:crypto\"\n\nimport VError from \"verror\"\n\n/**\n * Encryption usecase implementing AES-GCM encryption/decryption\n */\nexport class EncryptionModule {\n\t/**\n\t * Encrypts data using AES-GCM algorithm\n\t */\n\tstatic async aesGcmEncrypt(\n\t\tdata: Uint8Array,\n\t\tencryptionKey: string,\n\t\tnonce?: Uint8Array | null,\n\t): Promise<{\n\t\t/** Base64 encoded ciphertext */\n\t\tciphertext: string\n\t\t/** Nonce used for encryption */\n\t\tnonce: Uint8Array\n\t}> {\n\t\ttry {\n\t\t\t// Generate nonce if not provided\n\t\t\tconst actualNonce = nonce ?? crypto.randomBytes(12)\n\n\t\t\t// Validate encryption key length\n\t\t\tconst keyBuffer = Buffer.from(encryptionKey, \"utf8\")\n\t\t\tif (keyBuffer.length !== 32) {\n\t\t\t\tthrow new VError(\"Encryption key must be exactly 32 bytes for AES-256\")\n\t\t\t}\n\n\t\t\t// Create cipher\n\t\t\tconst cipher = crypto.createCipheriv(\"aes-256-gcm\", keyBuffer, actualNonce)\n\n\t\t\t// Encrypt the data\n\t\t\tconst encrypted = Buffer.concat([cipher.update(data), cipher.final()])\n\t\t\tconst authTag = cipher.getAuthTag()\n\n\t\t\t// Combine encrypted data and auth tag\n\t\t\tconst ciphertext = Buffer.concat([encrypted, authTag])\n\n\t\t\t// Convert to base64\n\t\t\tconst base64Ciphertext = ciphertext.toString(\"base64\")\n\n\t\t\treturn {\n\t\t\t\tciphertext: base64Ciphertext,\n\t\t\t\tnonce: new Uint8Array(actualNonce),\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tthrow new VError(error as Error, `Failed to encrypt data`)\n\t\t}\n\t}\n\n\t/**\n\t * Decrypts data using AES-GCM algorithm\n\t */\n\tstatic async aesGcmDecrypt(data: string, nonce: Uint8Array, encryptionKey: string): Promise<Uint8Array> {\n\t\ttry {\n\t\t\t// Validate encryption key length\n\t\t\tconst keyBuffer = Buffer.from(encryptionKey, \"utf8\")\n\t\t\tif (keyBuffer.length !== 32) {\n\t\t\t\tthrow new VError(\"Encryption key must be exactly 32 bytes for AES-256\")\n\t\t\t}\n\n\t\t\t// Decode base64 data\n\t\t\tconst decodedData = Buffer.from(data, \"base64\")\n\n\t\t\t// Split ciphertext and auth tag (last 16 bytes)\n\t\t\tconst authTag = decodedData.subarray(-16)\n\t\t\tconst encrypted = decodedData.subarray(0, -16)\n\n\t\t\t// Create decipher\n\t\t\tconst decipher = crypto.createDecipheriv(\"aes-256-gcm\", keyBuffer, Buffer.from(nonce))\n\t\t\tdecipher.setAuthTag(authTag)\n\n\t\t\t// Decrypt the data\n\t\t\tconst plaintext = Buffer.concat([decipher.update(encrypted), decipher.final()])\n\n\t\t\treturn new Uint8Array(plaintext)\n\t\t} catch (error) {\n\t\t\tthrow new VError(error as Error, `Failed to decrypt data`)\n\t\t}\n\t}\n}\n"]}