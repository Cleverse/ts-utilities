{"version":3,"sources":["/home/runner/work/ts-utilities/ts-utilities/dist/chunk-AD7FTCR2.cjs","../src/storage/onedrive.ts"],"names":[],"mappings":"AAAA;AACE;AACF,wDAA6B;AAC7B;AACE;AACF,wDAA6B;AAC7B;AACA;ACPA,8CAAA,CAAA;AAIO,IAAM,gBAAA,EAAN,MAAM,iBAAgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAM5B,OAAO,uBAAA,CAAwB,aAAA,EAA4D;AAC1F,IAAA,MAAM,IAAA,EAAM,IAAI,GAAA,CAAI,aAAa,CAAA;AACjC,IAAA,MAAM,aAAA,EAAe,GAAA,CAAI,QAAA,CAAS,KAAA,CAAM,GAAG,CAAA,CAAE,MAAA,CAAO,CAAC,OAAA,EAAA,GAAY,OAAA,CAAQ,OAAA,EAAS,CAAC,CAAA;AAEnF,IAAA,MAAM,YAAA,EAAc,YAAA,CAAa,OAAA,CAAQ,QAAQ,CAAA;AACjD,IAAA,MAAM,WAAA,EAAa,YAAA,CAAa,OAAA,CAAQ,OAAO,CAAA;AAE/C,IAAA,GAAA,CAAI,YAAA,IAAgB,CAAA,EAAA,GAAM,WAAA,IAAe,CAAA,EAAA,GAAM,YAAA,GAAe,UAAA,EAAY;AACzE,MAAA,MAAM,IAAI,sCAAA,CAAgB,CAAA,gDAAA,EAAmD,aAAa,CAAA,CAAA;AAC3F,IAAA;AAE4C,IAAA;AACF,IAAA;AAEjB,IAAA;AACE,MAAA;AAC3B,IAAA;AAEO,IAAA;AACwC,MAAA;AACH,MAAA;AAC5C,IAAA;AACD,EAAA;AAAA;AAG4C,EAAA;AACpC,IAAA;AACR,EAAA;AAAA;AAG8C,EAAA;AAEf,IAAA;AACtB,MAAA;AACR,IAAA;AAK8C,IAAA;AAC/C,EAAA;AAAA;AAGmD,EAAA;AACrC,IAAA;AACkC,MAAA;AAC/C,IAAA;AACmC,IAAA;AACuD,MAAA;AAC1F,IAAA;AAC8B,IAAA;AACiD,MAAA;AAC/E,IAAA;AACO,IAAA;AACR,EAAA;AAEyG,EAAA;AAElE,IAAA;AAE2B,IAAA;AAClB,IAAA;AAE6C,IAAA;AAC7F,EAAA;AACD;ADXiG;AACA;AACA;AACA","file":"/home/runner/work/ts-utilities/ts-utilities/dist/chunk-AD7FTCR2.cjs","sourcesContent":[null,"import { BadRequestError } from \"../errors\"\n\nimport type { DriveItem } from \"@microsoft/microsoft-graph-types\"\n\nexport class OneDriveService {\n\t/**\n\t * Extract driveId and itemId from SharePoint URL\n\t *\n\t * @param {string} sharePointUrl - `https://{sharePointEndpoint}/drives/{driveId}/items/{itemId}`\n\t */\n\tstatic extractDriveItemFromURL(sharePointUrl: string): { driveId: string; itemId: string } {\n\t\tconst url = new URL(sharePointUrl)\n\t\tconst pathSegments = url.pathname.split(\"/\").filter((segment) => segment.length > 0)\n\n\t\tconst drivesIndex = pathSegments.indexOf(\"drives\")\n\t\tconst itemsIndex = pathSegments.indexOf(\"items\")\n\n\t\tif (drivesIndex === -1 || itemsIndex === -1 || drivesIndex >= itemsIndex) {\n\t\t\tthrow new BadRequestError(`OneDriveService: Invalid SharePoint URL format: ${sharePointUrl}`)\n\t\t}\n\n\t\tconst driveId = pathSegments[drivesIndex + 1]\n\t\tconst itemId = pathSegments[itemsIndex + 1]\n\n\t\tif (!driveId || !itemId) {\n\t\t\tthrow new BadRequestError(`OneDriveService: Could not extract driveId or itemId from URL: ${sharePointUrl}`)\n\t\t}\n\n\t\treturn {\n\t\t\tdriveId: OneDriveService.formatDriveId(driveId),\n\t\t\titemId: OneDriveService.formatItemId(itemId),\n\t\t}\n\t}\n\n\t// Convert itemId to standard format\n\tstatic formatItemId(itemId: string): string {\n\t\treturn itemId // TODO: no need to format itemId yet\n\t}\n\n\t// Convert driveId to standard format\n\tstatic formatDriveId(driveId: string): string {\n\t\t// b! prefix indicates Organization account (not Hex), leave as-is\n\t\tif (driveId.startsWith(\"b!\")) {\n\t\t\treturn driveId\n\t\t}\n\n\t\t// Otherwise it's likely Hex:\n\t\t// 1. Strip leading zeros\n\t\t// 2. Convert to UPPERCASE\n\t\treturn driveId.replace(/^0+/, \"\").toUpperCase()\n\t}\n\n\t// Format the drive item to the standard format\n\tstatic formatDriveItem(item: DriveItem): DriveItem {\n\t\tif (item.id) {\n\t\t\titem.id = OneDriveService.formatItemId(item.id)\n\t\t}\n\t\tif (item.parentReference?.driveId) {\n\t\t\titem.parentReference.driveId = OneDriveService.formatDriveId(item.parentReference.driveId)\n\t\t}\n\t\tif (item.parentReference?.id) {\n\t\t\titem.parentReference.id = OneDriveService.formatItemId(item.parentReference.id)\n\t\t}\n\t\treturn item\n\t}\n\n\tstatic encodeOneDriveItemUri(item: DriveItem, driveType: \"onedrive\" | \"sharepoint\" = \"onedrive\"): string {\n\t\tconst driveId = item.parentReference?.driveId\n\t\t\t? OneDriveService.formatDriveId(item.parentReference.driveId)\n\t\t\t: \"unknown\"\n\t\tconst itemId = item.id ? OneDriveService.formatItemId(item.id) : \"unknown\"\n\t\tconst siteId = item.parentReference?.siteId ?? \"unknown\"\n\n\t\treturn driveType === \"onedrive\" ? `onedrive://${driveId}/${itemId}` : `sharepoint://${siteId}/${driveId}/${itemId}`\n\t}\n}\n"]}