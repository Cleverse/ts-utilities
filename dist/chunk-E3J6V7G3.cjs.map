{"version":3,"sources":["/home/runner/work/ts-utilities/ts-utilities/dist/chunk-E3J6V7G3.cjs","../src/storage/helper.ts"],"names":[],"mappings":"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","file":"/home/runner/work/ts-utilities/ts-utilities/dist/chunk-E3J6V7G3.cjs","sourcesContent":[null,"import mime from \"mime\"\nimport { VError } from \"verror\"\n\nimport { CloudStorageService } from \"./cloud-storage\"\nimport { OneDriveService } from \"./onedrive\"\nimport { FileUri } from \"./type\"\n\n/**\n * Facade layer for file operations (GCS/OneDrive/SharePoint/Public)\n */\nexport class FileHelper {\n\t/**\n\t * Extract file URI information from the given URI.\n\t * alias for `decodeUri`\n\t */\n\tstatic extractFileUri(fileUrl: string): FileUri {\n\t\treturn FileHelper.decodeUri(fileUrl)\n\t}\n\n\t/**\n\t * Decode file URI information from the given URI\n\t * - CloudStorage\n\t *   - `gs://{bucketName}/{filePath}`\n\t *   - `https://storage.googleapis.com/{bucketName}/{filePath}`\n\t *   - `https://{bucketName}.storage.googleapis.com/{filePath}`\n\t * - OneDrive - `onedrive://{driveId}/{itemId}`\n\t * - SharePoint - `sharepoint://{siteId}/{driveId}/{itemId}`\n\t * - Public - `https://{publicUrl}` | `http://{publicUrl}`\n\t */\n\tstatic decodeUri(fileUrl: string): FileUri {\n\t\ttry {\n\t\t\tconst url = new URL(fileUrl)\n\n\t\t\tswitch (url.protocol) {\n\t\t\t\tcase \"gs:\": {\n\t\t\t\t\tconst bucketName = url.hostname\n\t\t\t\t\tconst filePath = url.pathname.startsWith(\"/\") ? url.pathname.slice(1) : url.pathname\n\t\t\t\t\tif (!bucketName || !filePath) {\n\t\t\t\t\t\tthrow new VError(`Invalid GCS URL format, expecting 'gs://{bucketName}/{filePath}'`)\n\t\t\t\t\t}\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttype: \"gcs\",\n\t\t\t\t\t\turi: `gs://${bucketName}/${decodeURIComponent(filePath)}`,\n\t\t\t\t\t\tbucketName,\n\t\t\t\t\t\tfilePath,\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcase \"onedrive:\": {\n\t\t\t\t\tlet driveId = url.hostname\n\t\t\t\t\tlet itemId = url.pathname.startsWith(\"/\") ? url.pathname.slice(1) : url.pathname\n\t\t\t\t\tif (!driveId || !itemId) {\n\t\t\t\t\t\tthrow new VError(`Invalid OneDrive URL format, expecting 'onedrive://{driveId}/{itemId}'`)\n\t\t\t\t\t}\n\n\t\t\t\t\tdriveId = OneDriveService.formatDriveId(driveId)\n\t\t\t\t\titemId = OneDriveService.formatItemId(itemId)\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttype: \"onedrive\",\n\t\t\t\t\t\turi: `onedrive://${driveId}/${itemId}`,\n\t\t\t\t\t\tdriveId,\n\t\t\t\t\t\titemId,\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcase \"sharepoint:\": {\n\t\t\t\t\tconst siteId = url.hostname\n\t\t\t\t\tconst pathParts = (url.pathname.startsWith(\"/\") ? url.pathname.slice(1) : url.pathname).split(\"/\")\n\t\t\t\t\tif (pathParts.length < 2) {\n\t\t\t\t\t\tthrow new VError(`Invalid SharePoint URL format, expecting 'sharepoint://{siteId}/{driveId}/{itemId}'`)\n\t\t\t\t\t}\n\n\t\t\t\t\tconst driveId = OneDriveService.formatDriveId(pathParts[0] ?? \"\")\n\t\t\t\t\tconst itemId = OneDriveService.formatItemId(pathParts[1] ?? \"\")\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttype: \"sharepoint\",\n\t\t\t\t\t\turi: `sharepoint://${siteId}/${driveId}/${itemId}`,\n\t\t\t\t\t\tsiteId,\n\t\t\t\t\t\tdriveId,\n\t\t\t\t\t\titemId,\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcase \"http:\":\n\t\t\t\tcase \"https:\": {\n\t\t\t\t\tif (CloudStorageService.isGCSUrl(fileUrl)) {\n\t\t\t\t\t\tconst info = CloudStorageService.extractInfo(fileUrl)\n\t\t\t\t\t\tif (!info) {\n\t\t\t\t\t\t\tthrow new VError(`Invalid GCS URL format, expecting 'gs://{bucketName}/{filePath}'`)\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\ttype: \"gcs\",\n\t\t\t\t\t\t\turi: CloudStorageService.toGCSUri(info),\n\t\t\t\t\t\t\tbucketName: info.bucketName,\n\t\t\t\t\t\t\tfilePath: info.filePath,\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttype: \"public\",\n\t\t\t\t\t\turi: fileUrl,\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tdefault:\n\t\t\t\t\tthrow new VError(`Unsupported file URL scheme: ${url.protocol}`)\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tif (error instanceof VError) {\n\t\t\t\tthrow error\n\t\t\t}\n\t\t\tthrow new VError({ cause: error as Error }, `Invalid file URL: ${fileUrl}`)\n\t\t}\n\t}\n\n\t/**\n\t * Encode file URI information to a string.\n\t * - CloudStorage\n\t *   - `gs://{bucketName}/{filePath}`\n\t *   - `https://storage.googleapis.com/{bucketName}/{filePath}`\n\t *   - `https://{bucketName}.storage.googleapis.com/{filePath}`\n\t * - OneDrive - `onedrive://{driveId}/{itemId}`\n\t * - SharePoint - `sharepoint://{siteId}/{driveId}/{itemId}`\n\t * - Public - `https://{publicUrl}` | `http://{publicUrl}`\n\t */\n\tstatic encodeUri(fileUri: FileUri): string {\n\t\tswitch (fileUri.type) {\n\t\t\tcase \"gcs\":\n\t\t\t\treturn `gs://${fileUri.bucketName}/${fileUri.filePath}`\n\t\t\tcase \"onedrive\":\n\t\t\t\treturn `onedrive://${OneDriveService.formatDriveId(fileUri.driveId)}/${OneDriveService.formatItemId(fileUri.itemId)}`\n\t\t\tcase \"sharepoint\":\n\t\t\t\treturn `sharepoint://${fileUri.siteId}/${OneDriveService.formatDriveId(fileUri.driveId)}/${OneDriveService.formatItemId(fileUri.itemId)}`\n\t\t\tcase \"public\":\n\t\t\t\treturn fileUri.uri\n\t\t\tdefault:\n\t\t\t\tthrow new VError(`Unsupported file URI type: ${fileUri}`)\n\t\t}\n\t}\n\n\t/**\n\t * Get the file extension from the MIME type\n\t */\n\tstatic mimeFileExtension(mimeType: string): string | null {\n\t\tconst extension = mime.getExtension(mimeType)\n\t\tif (!extension) {\n\t\t\treturn fallbackMimeToExt[mimeType] || null\n\t\t}\n\t\treturn extension\n\t}\n}\n\nconst fallbackMimeToExt: Record<string, string> = {\n\t\"application/pdf\": \"pdf\",\n\t\"application/msword\": \"doc\",\n\t\"application/vnd.openxmlformats-officedocument.wordprocessingml.document\": \"docx\",\n\t\"application/vnd.ms-excel\": \"xls\",\n\t\"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\": \"xlsx\",\n\t\"application/vnd.ms-powerpoint\": \"ppt\",\n\t\"application/vnd.openxmlformats-officedocument.presentationml.presentation\": \"pptx\",\n\t\"application/json\": \"json\",\n\t\"application/xml\": \"xml\",\n\t\"application/yaml\": \"yaml\",\n\t\"application/toml\": \"toml\",\n\t\"application/html\": \"html\",\n\t\"application/css\": \"css\",\n\t\"application/javascript\": \"js\",\n\t\"application/typescript\": \"ts\",\n}\n"]}