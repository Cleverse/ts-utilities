{"version":3,"sources":["../src/utils/sync/singleFlight.ts"],"sourcesContent":["/**\n * A cache for in-flight requests to prevent duplicate network calls (singleflight pattern)\n * When multiple identical requests are made concurrently, only the first one will be executed\n * and all others will receive the result from the first request.\n */\nexport class SingleFlight {\n\tprivate static locks = new Map<string, Promise<unknown>>()\n\n\t/**\n\t * Executes the provided function with a lock based on the given key.\n\t * If a request with the same key is already in progress, it returns the promise from that request.\n\t *\n\t * @param key - Unique identifier for the request\n\t * @param fn - Function to execute if no lock exists\n\t * @returns Promise with the result of the function execution\n\t */\n\tstatic async withLock<T>(key: string, fn: () => Promise<T>): Promise<T> {\n\t\t// If there's already a request in flight with this key, return its promise\n\t\tif (SingleFlight.locks.has(key)) {\n\t\t\treturn SingleFlight.locks.get(key) as Promise<T>\n\t\t}\n\n\t\ttry {\n\t\t\t// Store the promise in the locks object\n\t\t\tconst promise = fn()\n\t\t\tSingleFlight.locks.set(key, promise)\n\t\t\treturn await promise\n\t\t} finally {\n\t\t\tSingleFlight.locks.delete(key)\n\t\t}\n\t}\n\n\t/**\n\t * Removes all locks - useful for testing or forced resets\n\t */\n\tstatic clearAllLocks(): void {\n\t\tSingleFlight.locks.clear()\n\t}\n\n\t/**\n\t * Checks if a lock exists for the given key\n\t *\n\t * @param key - Unique identifier for the request\n\t * @returns boolean indicating if a lock exists\n\t */\n\tstatic hasLock(key: string): boolean {\n\t\treturn SingleFlight.locks.has(key)\n\t}\n}\n"],"mappings":";AAKO,IAAM,eAAN,MAAM,cAAa;AAAA,EACzB,OAAe,QAAQ,oBAAI,IAA8B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUzD,aAAa,SAAY,KAAa,IAAkC;AAEvE,QAAI,cAAa,MAAM,IAAI,GAAG,GAAG;AAChC,aAAO,cAAa,MAAM,IAAI,GAAG;AAAA,IAClC;AAEA,QAAI;AAEH,YAAM,UAAU,GAAG;AACnB,oBAAa,MAAM,IAAI,KAAK,OAAO;AACnC,aAAO,MAAM;AAAA,IACd,UAAE;AACD,oBAAa,MAAM,OAAO,GAAG;AAAA,IAC9B;AAAA,EACD;AAAA;AAAA;AAAA;AAAA,EAKA,OAAO,gBAAsB;AAC5B,kBAAa,MAAM,MAAM;AAAA,EAC1B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,OAAO,QAAQ,KAAsB;AACpC,WAAO,cAAa,MAAM,IAAI,GAAG;AAAA,EAClC;AACD;","names":[]}