{"version":3,"sources":["../../src/logger/index.ts"],"sourcesContent":["import pino from \"pino\"\n\nimport { gcpPinoLoggerOptions } from \"./gcp-options\"\nimport { Bindings, ILogger, MergingObject } from \"./interface\"\n\nimport type { LoggerOptions } from \"pino\"\n\ntype Environment = \"local\" | \"development\" | \"production\"\n\nconst loggerOptions: Record<Environment, LoggerOptions> = {\n\tlocal: {\n\t\tlevel: process.env.LOG_LEVEL || \"trace\",\n\t\tmessageKey: \"message\",\n\t\ttransport: {\n\t\t\ttarget: \"pino-pretty\",\n\t\t\toptions: {\n\t\t\t\ttranslateTime: \"HH:MM:ss Z\",\n\t\t\t\tignore: \"pid,hostname\",\n\t\t\t},\n\t\t},\n\t},\n\tdevelopment: {\n\t\tlevel: process.env.LOG_LEVEL || \"debug\",\n\n\t\t...gcpPinoLoggerOptions,\n\t},\n\tproduction: {\n\t\tlevel: process.env.LOG_LEVEL || \"info\",\n\t\t...gcpPinoLoggerOptions,\n\t},\n}\n\nexport class PinoAdapter implements ILogger {\n\t// Global default logger\n\tprivate static _logger = new PinoAdapter(\n\t\tpino(loggerOptions[process.env.ENVIRONMENT as Environment] ?? loggerOptions.local),\n\t)\n\n\tstatic get logger(): ILogger {\n\t\treturn PinoAdapter._logger\n\t}\n\n\t// Initialize logger with given environment\n\tstatic init(env: Environment) {\n\t\tconst pinoLogger = pino(loggerOptions[env])\n\t\tPinoAdapter._logger.set(pinoLogger)\n\t\treturn [pinoLogger, PinoAdapter._logger] as const\n\t}\n\n\t// Create a new logger\n\tstatic new(pino: pino.Logger): ILogger {\n\t\treturn new PinoAdapter(pino)\n\t}\n\n\tprivate constructor(private logger: pino.Logger) {}\n\n\twith(bindings: Bindings): ILogger {\n\t\treturn new PinoAdapter(this.logger.child(bindings))\n\t}\n\n\tchild(bindings: Bindings): ILogger {\n\t\treturn new PinoAdapter(this.logger.child(bindings))\n\t}\n\n\tfatal(msg: string, obj?: MergingObject): void {\n\t\tthis.logger.fatal(obj ?? {}, msg)\n\t}\n\n\terror(\n\t\tmsg: string,\n\t\tobj: MergingObject<{\n\t\t\tevent: string\n\t\t\terr: Error | unknown\n\t\t}>,\n\t): void {\n\t\tthis.logger.error(obj ?? {}, msg)\n\t}\n\n\twarn(\n\t\tmsg: string,\n\t\tobj: MergingObject<{\n\t\t\tevent: string\n\t\t}>,\n\t): void {\n\t\tthis.logger.warn(obj ?? {}, msg)\n\t}\n\n\tinfo(msg: string, obj?: MergingObject): void {\n\t\tthis.logger.info(obj ?? {}, msg)\n\t}\n\n\tdebug(msg: string, obj?: MergingObject): void {\n\t\tthis.logger.debug(obj ?? {}, msg)\n\t}\n\n\ttrace(msg: string, obj?: MergingObject): void {\n\t\tthis.logger.trace(obj ?? {}, msg)\n\t}\n\n\tsilent(msg: string, obj?: MergingObject): void {\n\t\tthis.logger.silent(obj ?? {}, msg)\n\t}\n\n\t// replace the underlying pino logger\n\tset(pino: pino.Logger): ILogger {\n\t\tthis.logger = pino\n\t\treturn this\n\t}\n}\n\nexport { pino } // Export pino for consumers who want to customize their own loggers\nexport const logger = PinoAdapter.logger\nexport default logger\n\n/**\n * Initialize logger with given environment\n *\n * @param env Environment\n * @returns [pinoLogger, Logger]\n */\nexport const init = PinoAdapter.init\n\nexport const defaultLoggerOptions = loggerOptions[process.env.ENVIRONMENT as Environment] ?? loggerOptions.local\nexport * from \"./interface\"\n"],"mappings":";;;;;;;AAAA,OAAO,UAAU;AASjB,IAAM,gBAAoD;AAAA,EACzD,OAAO;AAAA,IACN,OAAO,QAAQ,IAAI,aAAa;AAAA,IAChC,YAAY;AAAA,IACZ,WAAW;AAAA,MACV,QAAQ;AAAA,MACR,SAAS;AAAA,QACR,eAAe;AAAA,QACf,QAAQ;AAAA,MACT;AAAA,IACD;AAAA,EACD;AAAA,EACA,aAAa;AAAA,IACZ,OAAO,QAAQ,IAAI,aAAa;AAAA,IAEhC,GAAG;AAAA,EACJ;AAAA,EACA,YAAY;AAAA,IACX,OAAO,QAAQ,IAAI,aAAa;AAAA,IAChC,GAAG;AAAA,EACJ;AACD;AAEO,IAAM,cAAN,MAAM,aAA+B;AAAA,EAsBnC,YAAoBA,SAAqB;AAArB,kBAAAA;AAAA,EAAsB;AAAA;AAAA,EApBlD,OAAe,UAAU,IAAI;AAAA,IAC5B,KAAK,cAAc,QAAQ,IAAI,WAA0B,KAAK,cAAc,KAAK;AAAA,EAClF;AAAA,EAEA,WAAW,SAAkB;AAC5B,WAAO,aAAY;AAAA,EACpB;AAAA;AAAA,EAGA,OAAO,KAAK,KAAkB;AAC7B,UAAM,aAAa,KAAK,cAAc,GAAG,CAAC;AAC1C,iBAAY,QAAQ,IAAI,UAAU;AAClC,WAAO,CAAC,YAAY,aAAY,OAAO;AAAA,EACxC;AAAA;AAAA,EAGA,OAAO,IAAIC,OAA4B;AACtC,WAAO,IAAI,aAAYA,KAAI;AAAA,EAC5B;AAAA,EAIA,KAAK,UAA6B;AACjC,WAAO,IAAI,aAAY,KAAK,OAAO,MAAM,QAAQ,CAAC;AAAA,EACnD;AAAA,EAEA,MAAM,UAA6B;AAClC,WAAO,IAAI,aAAY,KAAK,OAAO,MAAM,QAAQ,CAAC;AAAA,EACnD;AAAA,EAEA,MAAM,KAAa,KAA2B;AAC7C,SAAK,OAAO,MAAM,OAAO,CAAC,GAAG,GAAG;AAAA,EACjC;AAAA,EAEA,MACC,KACA,KAIO;AACP,SAAK,OAAO,MAAM,OAAO,CAAC,GAAG,GAAG;AAAA,EACjC;AAAA,EAEA,KACC,KACA,KAGO;AACP,SAAK,OAAO,KAAK,OAAO,CAAC,GAAG,GAAG;AAAA,EAChC;AAAA,EAEA,KAAK,KAAa,KAA2B;AAC5C,SAAK,OAAO,KAAK,OAAO,CAAC,GAAG,GAAG;AAAA,EAChC;AAAA,EAEA,MAAM,KAAa,KAA2B;AAC7C,SAAK,OAAO,MAAM,OAAO,CAAC,GAAG,GAAG;AAAA,EACjC;AAAA,EAEA,MAAM,KAAa,KAA2B;AAC7C,SAAK,OAAO,MAAM,OAAO,CAAC,GAAG,GAAG;AAAA,EACjC;AAAA,EAEA,OAAO,KAAa,KAA2B;AAC9C,SAAK,OAAO,OAAO,OAAO,CAAC,GAAG,GAAG;AAAA,EAClC;AAAA;AAAA,EAGA,IAAIA,OAA4B;AAC/B,SAAK,SAASA;AACd,WAAO;AAAA,EACR;AACD;AAGO,IAAM,SAAS,YAAY;AAClC,IAAO,iBAAQ;AAQR,IAAM,OAAO,YAAY;AAEzB,IAAM,uBAAuB,cAAc,QAAQ,IAAI,WAA0B,KAAK,cAAc;","names":["logger","pino"]}