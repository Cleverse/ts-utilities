{"version":3,"sources":["../../src/logger/index.spec.ts"],"sourcesContent":["import { describe, expect, it, vi, beforeEach, afterEach } from \"vitest\"\n\nimport { gcpPinoLoggerOptions } from \"./gcp-options\"\n\n// Mock pino\nconst { mockPino } = vi.hoisted(() => {\n\tconst mockInstance = {\n\t\tchild: vi.fn(),\n\t\tfatal: vi.fn(),\n\t\terror: vi.fn(),\n\t\twarn: vi.fn(),\n\t\tinfo: vi.fn(),\n\t\tdebug: vi.fn(),\n\t\ttrace: vi.fn(),\n\t\tsilent: vi.fn(),\n\t\tset: vi.fn(),\n\t}\n\tmockInstance.child.mockReturnValue(mockInstance)\n\treturn {\n\t\tmockPinoInstance: mockInstance,\n\t\tmockPino: vi.fn(() => mockInstance),\n\t}\n})\n\nvi.mock(\"pino\", () => {\n\treturn {\n\t\tdefault: mockPino,\n\t}\n})\n\ndescribe(\"PinoAdapter\", () => {\n\t// Save original env\n\tconst originalEnv = process.env\n\n\tbeforeEach(() => {\n\t\tvi.resetModules()\n\t\tvi.clearAllMocks()\n\t\tprocess.env = { ...originalEnv }\n\t})\n\n\tafterEach(() => {\n\t\tprocess.env = originalEnv\n\t})\n\n\tdescribe(\"init\", () => {\n\t\tit(\"should configure logger for local environment\", async () => {\n\t\t\tconst { PinoAdapter } = await import(\"./index\")\n\t\t\tPinoAdapter.init(\"local\")\n\n\t\t\texpect(mockPino).toHaveBeenCalledWith(\n\t\t\t\texpect.objectContaining({\n\t\t\t\t\tlevel: \"trace\",\n\t\t\t\t\ttransport: {\n\t\t\t\t\t\ttarget: \"pino-pretty\",\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\ttranslateTime: \"HH:MM:ss Z\",\n\t\t\t\t\t\t\tignore: \"pid,hostname\",\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t)\n\t\t})\n\n\t\tit(\"should configure logger for development environment\", async () => {\n\t\t\tconst { PinoAdapter } = await import(\"./index\")\n\t\t\tPinoAdapter.init(\"development\")\n\n\t\t\texpect(mockPino).toHaveBeenLastCalledWith(\n\t\t\t\texpect.objectContaining({\n\t\t\t\t\tlevel: \"debug\",\n\t\t\t\t\tmessageKey: gcpPinoLoggerOptions.messageKey,\n\t\t\t\t}),\n\t\t\t)\n\t\t})\n\n\t\tit(\"should configure logger for production environment\", async () => {\n\t\t\tconst { PinoAdapter } = await import(\"./index\")\n\t\t\tPinoAdapter.init(\"production\")\n\n\t\t\texpect(mockPino).toHaveBeenLastCalledWith(\n\t\t\t\texpect.objectContaining({\n\t\t\t\t\tlevel: \"info\",\n\t\t\t\t\tmessageKey: gcpPinoLoggerOptions.messageKey,\n\t\t\t\t}),\n\t\t\t)\n\t\t})\n\n\t\tit(\"should respect LOG_LEVEL environment variable\", async () => {\n\t\t\tprocess.env.LOG_LEVEL = \"error\"\n\t\t\tconst { PinoAdapter } = await import(\"./index\")\n\t\t\tPinoAdapter.init(\"local\")\n\n\t\t\texpect(mockPino).toHaveBeenCalledWith(\n\t\t\t\texpect.objectContaining({\n\t\t\t\t\tlevel: \"error\",\n\t\t\t\t}),\n\t\t\t)\n\t\t})\n\t})\n})\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA,oBAAgE;AAEhE,yBAAqC;AAGrC,MAAM,EAAE,SAAS,IAAI,iBAAG,QAAQ,MAAM;AACrC,QAAM,eAAe;AAAA,IACpB,OAAO,iBAAG,GAAG;AAAA,IACb,OAAO,iBAAG,GAAG;AAAA,IACb,OAAO,iBAAG,GAAG;AAAA,IACb,MAAM,iBAAG,GAAG;AAAA,IACZ,MAAM,iBAAG,GAAG;AAAA,IACZ,OAAO,iBAAG,GAAG;AAAA,IACb,OAAO,iBAAG,GAAG;AAAA,IACb,QAAQ,iBAAG,GAAG;AAAA,IACd,KAAK,iBAAG,GAAG;AAAA,EACZ;AACA,eAAa,MAAM,gBAAgB,YAAY;AAC/C,SAAO;AAAA,IACN,kBAAkB;AAAA,IAClB,UAAU,iBAAG,GAAG,MAAM,YAAY;AAAA,EACnC;AACD,CAAC;AAED,iBAAG,KAAK,QAAQ,MAAM;AACrB,SAAO;AAAA,IACN,SAAS;AAAA,EACV;AACD,CAAC;AAAA,IAED,wBAAS,eAAe,MAAM;AAE7B,QAAM,cAAc,QAAQ;AAE5B,gCAAW,MAAM;AAChB,qBAAG,aAAa;AAChB,qBAAG,cAAc;AACjB,YAAQ,MAAM,EAAE,GAAG,YAAY;AAAA,EAChC,CAAC;AAED,+BAAU,MAAM;AACf,YAAQ,MAAM;AAAA,EACf,CAAC;AAED,8BAAS,QAAQ,MAAM;AACtB,0BAAG,iDAAiD,YAAY;AAC/D,YAAM,EAAE,YAAY,IAAI,MAAM,OAAO,SAAS;AAC9C,kBAAY,KAAK,OAAO;AAExB,gCAAO,QAAQ,EAAE;AAAA,QAChB,qBAAO,iBAAiB;AAAA,UACvB,OAAO;AAAA,UACP,WAAW;AAAA,YACV,QAAQ;AAAA,YACR,SAAS;AAAA,cACR,eAAe;AAAA,cACf,QAAQ;AAAA,YACT;AAAA,UACD;AAAA,QACD,CAAC;AAAA,MACF;AAAA,IACD,CAAC;AAED,0BAAG,uDAAuD,YAAY;AACrE,YAAM,EAAE,YAAY,IAAI,MAAM,OAAO,SAAS;AAC9C,kBAAY,KAAK,aAAa;AAE9B,gCAAO,QAAQ,EAAE;AAAA,QAChB,qBAAO,iBAAiB;AAAA,UACvB,OAAO;AAAA,UACP,YAAY,wCAAqB;AAAA,QAClC,CAAC;AAAA,MACF;AAAA,IACD,CAAC;AAED,0BAAG,sDAAsD,YAAY;AACpE,YAAM,EAAE,YAAY,IAAI,MAAM,OAAO,SAAS;AAC9C,kBAAY,KAAK,YAAY;AAE7B,gCAAO,QAAQ,EAAE;AAAA,QAChB,qBAAO,iBAAiB;AAAA,UACvB,OAAO;AAAA,UACP,YAAY,wCAAqB;AAAA,QAClC,CAAC;AAAA,MACF;AAAA,IACD,CAAC;AAED,0BAAG,iDAAiD,YAAY;AAC/D,cAAQ,IAAI,YAAY;AACxB,YAAM,EAAE,YAAY,IAAI,MAAM,OAAO,SAAS;AAC9C,kBAAY,KAAK,OAAO;AAExB,gCAAO,QAAQ,EAAE;AAAA,QAChB,qBAAO,iBAAiB;AAAA,UACvB,OAAO;AAAA,QACR,CAAC;AAAA,MACF;AAAA,IACD,CAAC;AAAA,EACF,CAAC;AACF,CAAC;","names":[]}