{"version":3,"sources":["/home/runner/work/ts-utilities/ts-utilities/dist/encryption/index.spec.cjs","../../src/encryption/index.spec.ts"],"names":["data"],"mappings":"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","file":"/home/runner/work/ts-utilities/ts-utilities/dist/encryption/index.spec.cjs","sourcesContent":[null,"import crypto from \"node:crypto\"\n\nimport { describe, expect, it } from \"vitest\"\n\nimport { EncryptionModule } from \"./index\"\n\ndescribe(\"EncryptionModule\", () => {\n\tconst validKey = \"12345678901234567890123456789012\" // ascii string 32 bytes\n\tconst data = new Uint8Array(Buffer.from(\"hello world\"))\n\n\tdescribe(\"aesGcmEncrypt\", () => {\n\t\tit(\"should encrypt data correctly and return ciphertext and nonce\", async () => {\n\t\t\tconst result = await EncryptionModule.aesGcmEncrypt(data, validKey)\n\n\t\t\texpect(result.ciphertext).toBeDefined()\n\t\t\texpect(typeof result.ciphertext).toBe(\"string\")\n\t\t\texpect(result.nonce).toBeDefined()\n\t\t\texpect(result.nonce).toBeInstanceOf(Uint8Array)\n\t\t\texpect(result.nonce.length).toBe(12)\n\t\t})\n\n\t\tit(\"should use provided nonce if given\", async () => {\n\t\t\tconst nonce = crypto.randomBytes(12)\n\t\t\tconst result = await EncryptionModule.aesGcmEncrypt(data, validKey, nonce)\n\n\t\t\texpect(result.nonce).toEqual(new Uint8Array(nonce))\n\t\t})\n\n\t\tit(\"should throw error if key length is invalid\", async () => {\n\t\t\tawait expect(EncryptionModule.aesGcmEncrypt(data, \"invalid-length\")).rejects.toThrow(\n\t\t\t\t\"Encryption key must be exactly 32 bytes for AES-256\",\n\t\t\t)\n\t\t})\n\t})\n\n\tdescribe(\"aesGcmDecrypt\", () => {\n\t\tit(\"should decrypt data correctly\", async () => {\n\t\t\tconst { ciphertext, nonce } = await EncryptionModule.aesGcmEncrypt(data, validKey)\n\n\t\t\tconst decrypted = await EncryptionModule.aesGcmDecrypt(ciphertext, nonce, validKey)\n\n\t\t\texpect(decrypted).toEqual(data)\n\t\t\texpect(Buffer.from(decrypted).toString()).toBe(\"hello world\")\n\t\t})\n\n\t\tit(\"should throw error if key length is invalid\", async () => {\n\t\t\tconst { ciphertext, nonce } = await EncryptionModule.aesGcmEncrypt(data, validKey)\n\n\t\t\tawait expect(EncryptionModule.aesGcmDecrypt(ciphertext, nonce, \"invalid-length\")).rejects.toThrow(\n\t\t\t\t\"Encryption key must be exactly 32 bytes for AES-256\",\n\t\t\t)\n\t\t})\n\n\t\tit(\"should fail to decrypt with wrong key\", async () => {\n\t\t\tconst { ciphertext, nonce } = await EncryptionModule.aesGcmEncrypt(data, validKey)\n\t\t\tconst wrongKey = \"12345678901234567890123456789013\" // 32 bytes different key\n\n\t\t\tawait expect(EncryptionModule.aesGcmDecrypt(ciphertext, nonce, wrongKey)).rejects.toThrow(\n\t\t\t\t\"Failed to decrypt data\",\n\t\t\t)\n\t\t})\n\t})\n\n\tdescribe(\"generateEncryptionKey\", () => {\n\t\tit(\"should generate a 64-character hex key by default (32 bytes)\", () => {\n\t\t\tconst key = EncryptionModule.generateEncryptionKey()\n\t\t\texpect(typeof key).toBe(\"string\")\n\t\t\texpect(key.length).toBe(64) // 32 bytes * 2 hex chars\n\t\t\texpect(/^[0-9a-fA-F]+$/.test(key)).toBe(true)\n\t\t})\n\n\t\tit(\"should generate a 64-character hex key when specified\", () => {\n\t\t\tconst key = EncryptionModule.generateEncryptionKey(\"hex\")\n\t\t\texpect(typeof key).toBe(\"string\")\n\t\t\texpect(key.length).toBe(64)\n\t\t\texpect(/^[0-9a-fA-F]+$/.test(key)).toBe(true)\n\t\t})\n\n\t\tit(\"should generate a 44-character base64 key (32 bytes)\", () => {\n\t\t\tconst key = EncryptionModule.generateEncryptionKey(\"base64\")\n\t\t\texpect(typeof key).toBe(\"string\")\n\t\t\texpect(key.length).toBe(44) // 32 bytes in base64\n\t\t\texpect(/^[a-zA-Z0-9+/=]+$/.test(key)).toBe(true)\n\t\t})\n\n\t\tit(\"should generate a 32-character ascii key (32 bytes)\", () => {\n\t\t\tconst key = EncryptionModule.generateEncryptionKey(\"ascii\")\n\t\t\texpect(typeof key).toBe(\"string\")\n\t\t\texpect(key.length).toBe(32)\n\t\t})\n\n\t\tit(\"should generate a 32-character utf8 key (legacy fallback)\", () => {\n\t\t\tconst key = EncryptionModule.generateEncryptionKey(\"utf8\")\n\t\t\texpect(typeof key).toBe(\"string\")\n\t\t\texpect(key.length).toBe(32) // 16 bytes hex -> 32 chars\n\t\t})\n\n\t\tit(\"should generate different keys on subsequent calls\", () => {\n\t\t\tconst key1 = EncryptionModule.generateEncryptionKey()\n\t\t\tconst key2 = EncryptionModule.generateEncryptionKey()\n\t\t\texpect(key1).not.toBe(key2)\n\t\t})\n\n\t\tit.each([\"hex\", \"base64\", \"ascii\", \"utf8\"] as const)(\n\t\t\t\"should generate a key compatible with aesGcmEncrypt (%s)\",\n\t\t\tasync (encoding) => {\n\t\t\t\tconst key = EncryptionModule.generateEncryptionKey(encoding)\n\t\t\t\tconst data = new Uint8Array(Buffer.from(\"hello world\"))\n\t\t\t\tconst result = await EncryptionModule.aesGcmEncrypt(data, key)\n\t\t\t\texpect(result.ciphertext).toBeDefined()\n\n\t\t\t\tconst decrypted = await EncryptionModule.aesGcmDecrypt(result.ciphertext, result.nonce, key)\n\t\t\t\texpect(decrypted).toEqual(data)\n\t\t\t},\n\t\t)\n\t})\n\n\tdescribe(\"Key Formats\", () => {\n\t\tconst hexKey = \"6fb64e13eb0ad85478f7e792faf6ac8bf46ddd39483e8aed16a82cc5eaaead55\" // 64 chars hex\n\t\tconst base64Key = Buffer.from(hexKey, \"hex\").toString(\"base64\") // 44 chars base64\n\t\tconst utf8Key = \"12345678901234567890123456789012\" // 32 chars utf8\n\n\t\tit(\"should support hex encoded key (64 chars)\", async () => {\n\t\t\tconst result = await EncryptionModule.aesGcmEncrypt(data, hexKey)\n\t\t\texpect(result.ciphertext).toBeDefined()\n\t\t\tconst decrypted = await EncryptionModule.aesGcmDecrypt(result.ciphertext, result.nonce, hexKey)\n\t\t\texpect(decrypted).toEqual(data)\n\t\t})\n\n\t\tit(\"should support base64 encoded key (44 chars)\", async () => {\n\t\t\tconst result = await EncryptionModule.aesGcmEncrypt(data, base64Key)\n\t\t\texpect(result.ciphertext).toBeDefined()\n\t\t\tconst decrypted = await EncryptionModule.aesGcmDecrypt(result.ciphertext, result.nonce, base64Key)\n\t\t\texpect(decrypted).toEqual(data)\n\t\t})\n\n\t\tit(\"should support utf8 key (32 chars)\", async () => {\n\t\t\tconst result = await EncryptionModule.aesGcmEncrypt(data, utf8Key)\n\t\t\texpect(result.ciphertext).toBeDefined()\n\t\t\tconst decrypted = await EncryptionModule.aesGcmDecrypt(result.ciphertext, result.nonce, utf8Key)\n\t\t\texpect(decrypted).toEqual(data)\n\t\t})\n\t})\n})\n"]}