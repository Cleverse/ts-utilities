{"version":3,"sources":["../../src/encryption/encryption.service.spec.ts"],"sourcesContent":["import crypto from \"node:crypto\"\n\nimport { beforeEach, describe, expect, it, vi } from \"vitest\"\n\nimport { KMSClient } from \"@/kms\"\n\nimport { EnvelopeEncryptionService, type DEK, type EncryptedDEK } from \"./encryption.service\"\n\nimport { EncryptionModule } from \"./index\"\n\n// Mock the EncryptionModule\nvi.mock(\"./index\", () => ({\n\tEncryptionModule: {\n\t\tencrypt: vi.fn(),\n\t\tdecrypt: vi.fn(),\n\t\tgenerateEncryptionKey: vi.fn(),\n\t},\n}))\n\nconst mockEncrypt = vi.mocked(EncryptionModule.encrypt)\nconst mockDecrypt = vi.mocked(EncryptionModule.decrypt)\nconst mockGenerateEncryptionKey = vi.mocked(EncryptionModule.generateEncryptionKey)\n\n// Mock the KMS client - create a partial implementation\nconst mockKMSEncrypt = vi.fn<() => Promise<{ ciphertext: string; cryptoKeyVersion: string }>>()\nconst mockKMSDecrypt = vi.fn<() => Promise<string>>()\n\nconst mockKMSClient = {\n\tencrypt: mockKMSEncrypt,\n\tdecrypt: mockKMSDecrypt,\n} as unknown as KMSClient\n\n// Mock the SharedDEKDatagateway\nconst mockSharedDEKDatagateway = {\n\tgetDEK: vi.fn<() => Promise<EncryptedDEK | null>>(),\n\tinsertNewDEK: vi.fn<() => Promise<EncryptedDEK>>(),\n}\n\ndescribe(\"EnvelopeEncryptionService\", () => {\n\tlet service: EnvelopeEncryptionService\n\tlet config: { defaultVersion?: number }\n\n\tbeforeEach(() => {\n\t\tvi.clearAllMocks()\n\t\tconfig = {}\n\t\tservice = new EnvelopeEncryptionService(mockKMSClient, mockSharedDEKDatagateway, config)\n\t})\n\n\tdescribe(\"encrypt\", () => {\n\t\tconst testData = new Uint8Array(Buffer.from(\"hello world\"))\n\t\tconst testNonce = crypto.randomBytes(12)\n\t\tconst encryptedResult = {\n\t\t\tciphertext: \"encrypted-data\",\n\t\t\tnonce: testNonce,\n\t\t}\n\t\tconst dek: DEK = {\n\t\t\tversion: 1,\n\t\t\tdek: \"test-dek-key\",\n\t\t\tkekVersion: 1,\n\t\t}\n\n\t\tit(\"should encrypt data with specified DEK version\", async () => {\n\t\t\tmockSharedDEKDatagateway.getDEK.mockResolvedValue({\n\t\t\t\tversion: 1,\n\t\t\t\tencryptedDek: \"encrypted-dek\",\n\t\t\t\tkekVersion: 1,\n\t\t\t})\n\t\t\tmockKMSDecrypt.mockResolvedValue(dek.dek)\n\t\t\tmockEncrypt.mockResolvedValue(encryptedResult)\n\n\t\t\tconst result = await service.encrypt(testData, testNonce, 1)\n\n\t\t\texpect(mockSharedDEKDatagateway.getDEK).toHaveBeenCalledWith(1)\n\t\t\texpect(mockKMSDecrypt).toHaveBeenCalledWith(\"encrypted-dek\", \"1\")\n\t\t\texpect(EncryptionModule.encrypt).toHaveBeenCalledWith(testData, dek.dek, testNonce)\n\t\t\texpect(result).toEqual({\n\t\t\t\tdekVersion: 1,\n\t\t\t\tnonce: testNonce,\n\t\t\t\tciphertext: \"encrypted-data\",\n\t\t\t})\n\t\t})\n\n\t\tit(\"should encrypt data with default DEK version when not specified\", async () => {\n\t\t\tconfig.defaultVersion = 2\n\t\t\tmockSharedDEKDatagateway.getDEK.mockResolvedValue({\n\t\t\t\tversion: 2,\n\t\t\t\tencryptedDek: \"encrypted-dek\",\n\t\t\t\tkekVersion: 1,\n\t\t\t})\n\t\t\tmockKMSDecrypt.mockResolvedValue(dek.dek)\n\t\t\tmockEncrypt.mockResolvedValue(encryptedResult)\n\n\t\t\tconst result = await service.encrypt(testData, testNonce)\n\n\t\t\texpect(mockSharedDEKDatagateway.getDEK).toHaveBeenCalledWith(2)\n\t\t\texpect(result.dekVersion).toBe(2)\n\t\t})\n\n\t\tit(\"should throw error when DEK is not found\", async () => {\n\t\t\tmockSharedDEKDatagateway.getDEK.mockResolvedValue(null)\n\n\t\t\tawait expect(service.encrypt(testData, testNonce, 1)).rejects.toThrow(\"Failed to encrypt data, DEK not found\")\n\t\t})\n\n\t\tit(\"should use generated nonce when not provided\", async () => {\n\t\t\tmockSharedDEKDatagateway.getDEK.mockResolvedValue({\n\t\t\t\tversion: 1,\n\t\t\t\tencryptedDek: \"encrypted-dek\",\n\t\t\t\tkekVersion: 1,\n\t\t\t})\n\t\t\tmockKMSDecrypt.mockResolvedValue(dek.dek)\n\t\t\tmockEncrypt.mockResolvedValue(encryptedResult)\n\n\t\t\tconst result = await service.encrypt(testData)\n\n\t\t\texpect(EncryptionModule.encrypt).toHaveBeenCalledWith(testData, dek.dek, undefined)\n\t\t\texpect(result.nonce).toEqual(testNonce)\n\t\t})\n\t})\n\n\tdescribe(\"decrypt\", () => {\n\t\tconst ciphertext = \"encrypted-data\"\n\t\tconst nonce = crypto.randomBytes(12)\n\t\tconst decryptedData = new Uint8Array(Buffer.from(\"hello world\"))\n\t\tconst dek: DEK = {\n\t\t\tversion: 1,\n\t\t\tdek: \"test-dek-key\",\n\t\t\tkekVersion: 1,\n\t\t}\n\n\t\tit(\"should decrypt data successfully\", async () => {\n\t\t\tmockSharedDEKDatagateway.getDEK.mockResolvedValue({\n\t\t\t\tversion: 1,\n\t\t\t\tencryptedDek: \"encrypted-dek\",\n\t\t\t\tkekVersion: 1,\n\t\t\t})\n\t\t\tmockKMSDecrypt.mockResolvedValue(dek.dek)\n\t\t\tmockDecrypt.mockResolvedValue(decryptedData)\n\n\t\t\tconst result = await service.decrypt(ciphertext, nonce, 1)\n\n\t\t\texpect(mockSharedDEKDatagateway.getDEK).toHaveBeenCalledWith(1)\n\t\t\texpect(mockKMSDecrypt).toHaveBeenCalledWith(\"encrypted-dek\", \"1\")\n\t\t\texpect(EncryptionModule.decrypt).toHaveBeenCalledWith(ciphertext, nonce, dek.dek)\n\t\t\texpect(result).toEqual(decryptedData)\n\t\t})\n\n\t\tit(\"should throw error when DEK is not found\", async () => {\n\t\t\tmockSharedDEKDatagateway.getDEK.mockResolvedValue(null)\n\n\t\t\tawait expect(service.decrypt(ciphertext, nonce, 1)).rejects.toThrow(\"Failed to decrypt data, DEK not found\")\n\t\t})\n\t})\n\n\tdescribe(\"rotateDEK\", () => {\n\t\tconst newDek = \"new-generated-dek\"\n\t\tconst encryptedDek = \"kms-encrypted-dek\"\n\t\tconst cryptoKeyVersion = \"1\"\n\t\tconst insertedDek: EncryptedDEK = {\n\t\t\tversion: 2,\n\t\t\tencryptedDek,\n\t\t\tkekVersion: 1,\n\t\t}\n\n\t\tit(\"should rotate DEK successfully\", async () => {\n\t\t\tmockGenerateEncryptionKey.mockReturnValue(newDek)\n\t\t\tmockKMSEncrypt.mockResolvedValue({\n\t\t\t\tciphertext: encryptedDek,\n\t\t\t\tcryptoKeyVersion,\n\t\t\t})\n\t\t\tmockSharedDEKDatagateway.insertNewDEK.mockResolvedValue(insertedDek)\n\n\t\t\tconst result = await service.rotateDEK()\n\n\t\t\texpect(EncryptionModule.generateEncryptionKey).toHaveBeenCalledWith(\"hex\")\n\t\t\texpect(mockKMSEncrypt).toHaveBeenCalledWith(newDek, undefined)\n\t\t\texpect(mockSharedDEKDatagateway.insertNewDEK).toHaveBeenCalledWith(encryptedDek, 1)\n\t\t\texpect(result).toBe(2)\n\t\t})\n\n\t\tit(\"should rotate DEK with specific KEK version\", async () => {\n\t\t\tconst kekVersion = \"2\"\n\t\t\tmockGenerateEncryptionKey.mockReturnValue(newDek)\n\t\t\tmockKMSEncrypt.mockResolvedValue({\n\t\t\t\tciphertext: encryptedDek,\n\t\t\t\tcryptoKeyVersion,\n\t\t\t})\n\t\t\tmockSharedDEKDatagateway.insertNewDEK.mockResolvedValue(insertedDek)\n\n\t\t\tconst result = await service.rotateDEK(kekVersion)\n\n\t\t\texpect(mockKMSEncrypt).toHaveBeenCalledWith(newDek, kekVersion)\n\t\t\texpect(result).toBe(2)\n\t\t})\n\t})\n\n\tdescribe(\"#getDEK (private method testing via caching behavior)\", () => {\n\t\tconst dek: DEK = {\n\t\t\tversion: 1,\n\t\t\tdek: \"test-dek-key\",\n\t\t\tkekVersion: 1,\n\t\t}\n\t\tconst encryptedDek: EncryptedDEK = {\n\t\t\tversion: 1,\n\t\t\tencryptedDek: \"encrypted-dek\",\n\t\t\tkekVersion: 1,\n\t\t}\n\n\t\tit(\"should cache DEK after first retrieval\", async () => {\n\t\t\tmockSharedDEKDatagateway.getDEK.mockResolvedValue(encryptedDek)\n\t\t\tmockKMSDecrypt.mockResolvedValue(dek.dek)\n\n\t\t\t// First call should fetch from database and decrypt\n\t\t\tawait service.encrypt(new Uint8Array(Buffer.from(\"test\")), null, 1)\n\t\t\texpect(mockSharedDEKDatagateway.getDEK).toHaveBeenCalledTimes(1)\n\t\t\texpect(mockKMSDecrypt).toHaveBeenCalledTimes(1)\n\n\t\t\t// Second call should use cache\n\t\t\tawait service.encrypt(new Uint8Array(Buffer.from(\"test\")), null, 1)\n\t\t\texpect(mockSharedDEKDatagateway.getDEK).toHaveBeenCalledTimes(1)\n\t\t\texpect(mockKMSDecrypt).toHaveBeenCalledTimes(1)\n\t\t})\n\n\t\tit(\"should not cache when DEK is not found\", async () => {\n\t\t\tmockSharedDEKDatagateway.getDEK.mockResolvedValue(null)\n\n\t\t\tawait expect(service.encrypt(new Uint8Array(Buffer.from(\"test\")), null, 1)).rejects.toThrow()\n\n\t\t\t// Should still try to fetch on next call\n\t\t\tawait expect(service.encrypt(new Uint8Array(Buffer.from(\"test\")), null, 1)).rejects.toThrow()\n\t\t\texpect(mockSharedDEKDatagateway.getDEK).toHaveBeenCalledTimes(2)\n\t\t})\n\n\t\tit(\"should use default version when no version specified\", async () => {\n\t\t\tconfig.defaultVersion = 5\n\t\t\tmockSharedDEKDatagateway.getDEK.mockResolvedValue(encryptedDek)\n\t\t\tmockKMSDecrypt.mockResolvedValue(dek.dek)\n\n\t\t\tawait service.encrypt(new Uint8Array(Buffer.from(\"test\")), null)\n\n\t\t\texpect(mockSharedDEKDatagateway.getDEK).toHaveBeenCalledWith(5)\n\t\t})\n\t})\n\n\tdescribe(\"error handling\", () => {\n\t\tit(\"should propagate errors from KMS client\", async () => {\n\t\t\tmockSharedDEKDatagateway.getDEK.mockResolvedValue({\n\t\t\t\tversion: 1,\n\t\t\t\tencryptedDek: \"encrypted-dek\",\n\t\t\t\tkekVersion: 1,\n\t\t\t})\n\t\t\tmockKMSDecrypt.mockRejectedValue(new Error(\"KMS error\"))\n\n\t\t\tawait expect(service.encrypt(new Uint8Array(Buffer.from(\"test\")), null, 1)).rejects.toThrow(\"KMS error\")\n\t\t})\n\n\t\tit(\"should propagate errors from EncryptionModule\", async () => {\n\t\t\tmockSharedDEKDatagateway.getDEK.mockResolvedValue({\n\t\t\t\tversion: 1,\n\t\t\t\tencryptedDek: \"encrypted-dek\",\n\t\t\t\tkekVersion: 1,\n\t\t\t})\n\t\t\tmockKMSDecrypt.mockResolvedValue(\"test-dek-key\")\n\t\t\tmockEncrypt.mockRejectedValue(new Error(\"Encryption error\"))\n\n\t\t\tawait expect(service.encrypt(new Uint8Array(Buffer.from(\"test\")), null, 1)).rejects.toThrow(\"Encryption error\")\n\t\t})\n\n\t\tit(\"should propagate errors from SharedDEKDatagateway\", async () => {\n\t\t\tmockSharedDEKDatagateway.getDEK.mockRejectedValue(new Error(\"Database error\"))\n\n\t\t\tawait expect(service.encrypt(new Uint8Array(Buffer.from(\"test\")), null, 1)).rejects.toThrow(\"Database error\")\n\t\t})\n\t})\n\n\tdescribe(\"integration scenarios\", () => {\n\t\tit(\"should handle full encrypt/decrypt cycle\", async () => {\n\t\t\tconst originalData = new Uint8Array(Buffer.from(\"secret data\"))\n\t\t\tconst dek: DEK = {\n\t\t\t\tversion: 1,\n\t\t\t\tdek: \"test-dek-key\",\n\t\t\t\tkekVersion: 1,\n\t\t\t}\n\n\t\t\t// Setup mocks for encrypt\n\t\t\tmockSharedDEKDatagateway.getDEK.mockResolvedValue({\n\t\t\t\tversion: 1,\n\t\t\t\tencryptedDek: \"encrypted-dek\",\n\t\t\t\tkekVersion: 1,\n\t\t\t})\n\t\t\tmockKMSDecrypt.mockResolvedValue(dek.dek)\n\t\t\tmockEncrypt.mockResolvedValue({\n\t\t\t\tciphertext: \"encrypted-payload\",\n\t\t\t\tnonce: crypto.randomBytes(12),\n\t\t\t})\n\n\t\t\t// Encrypt\n\t\t\tconst encryptResult = await service.encrypt(originalData, null, 1)\n\n\t\t\t// Setup mocks for decrypt (same DEK should be cached)\n\t\t\tmockDecrypt.mockResolvedValue(originalData)\n\n\t\t\t// Decrypt\n\t\t\tconst decryptResult = await service.decrypt(\n\t\t\t\tencryptResult.ciphertext,\n\t\t\t\tencryptResult.nonce,\n\t\t\t\tencryptResult.dekVersion,\n\t\t\t)\n\n\t\t\texpect(decryptResult).toEqual(originalData)\n\t\t\t// Should use cached DEK\n\t\t\texpect(mockSharedDEKDatagateway.getDEK).toHaveBeenCalledTimes(1)\n\t\t\texpect(mockKMSDecrypt).toHaveBeenCalledTimes(1)\n\t\t})\n\t})\n})\n"],"mappings":"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","names":[]}